/*
 * GuardaSeguimiento.java
 *
 * Created on 19 de mayo de 2005, 09:30 PM

 */
package Utilerias;

import java.sql.ResultSet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.ServletConfig;
import javax.servlet.ServletException;
import java.io.IOException;
import javax.servlet.http.HttpSession;
import java.io.PrintWriter;

/*
 *
 * @author
 * cabrerar
 * @version
 */
public class GuardaSeguimiento extends HttpServlet {

    public void init(ServletConfig config) throws ServletException {
        super.init(config);

    }

    public void destroy() {
    }

    protected void processRequest(HttpServletRequest request, HttpServletResponse response)
            throws ServletException, IOException {
        HttpSession sessionH = request.getSession(false);

        response.setContentType("text/html");
        PrintWriter out = response.getWriter();

        out.println("<html>");
        out.println("<head>");
        out.println("<title>Guarda Seguimiento</title>");
        out.println("</head>");
        out.println("<body>");

        String strTipoSeguimiento = "";
        if (request.getParameter("TipoSeg0") != null) {
            strTipoSeguimiento = request.getParameter("TipoSeg0").toString();
        } else {
            if (request.getParameter("TipoSeg1") != null) {
                strTipoSeguimiento = request.getParameter("TipoSeg1").toString();
            } else {
                out.println("<p class='class='cssTitDet'>Error en el Tipo de Seguimiento. Consulte a su Administrador.</p>");
                out.println("</body>");
                out.println("</html>");
                return;
            }
        }
        ResultSet rsEx = null;
        String StrclExpediente = "0";
        String StrclExpedienteBK = "0";
        String StrclEstatus = "0";
        String StrclProveedor = "0";
        String StrObservaciones = "";
        String StrURLBACK = "";
        String StrclUsrApp = "0";
        String StrclMotivo = "0";

        if (sessionH.getAttribute("clUsrApp") != null) {
            StrclUsrApp = sessionH.getAttribute("clUsrApp").toString();
        } else {
            out.println("<p class='class='cssTitDet'>No ha iniciado sesión o caducó. Por favor ingrese de nuevo.</p>");
            out.println("</body>");
            out.println("</html>");
            out.close();
            return;
        }

        switch (Integer.parseInt(strTipoSeguimiento)) {
            case 0:
                if (request.getParameter("clEstatus0") != null) {
                    StrclEstatus = request.getParameter("clEstatus0").toString();
                    if (request.getParameter("clEstatus0").toString().compareToIgnoreCase("") != 0) {
                        StrclEstatus = request.getParameter("clEstatus0").toString();
                    } else {
                        out.println("<p class='class='cssTitDet'>Debe informar estatus.</p>");
                        out.println("</body>");
                        out.println("</html>");
                        out.close();
                        return;
                    }
                } else {
                    out.println("<p class='class='cssTitDet'>Debe informar estatus.</p>");
                    out.println("</body>");
                    out.println("</html>");
                    out.close();
                    return;
                }

                if (sessionH.getAttribute("clExpediente") != null) {
                    StrclExpediente = sessionH.getAttribute("clExpediente").toString();
                }

                if (request.getParameter("URLBACK0") != null) {
                    StrURLBACK = request.getParameter("URLBACK0").toString();
                } else {
                    out.println("<p class='class='cssTitDet'>Error en la carga de información. Consulte a su Administrador.</p>");
                    out.println("</body>");
                    out.println("</html>");
                    out.close();
                    return;
                }

                if (request.getParameter("Observaciones0") != null) {
                    StrObservaciones = request.getParameter("Observaciones0").toString();
                }

                if (request.getParameter("clMotivo0") != null) {
                    StrclMotivo = request.getParameter("clMotivo0").toString();
                }

                break;

            case 1:
                if (request.getParameter("clEstatus1") != null) {
                    StrclEstatus = request.getParameter("clEstatus1").toString();
                    if (request.getParameter("clEstatus1").toString().compareToIgnoreCase("") != 0) {
                        StrclEstatus = request.getParameter("clEstatus1").toString();
                    } else {
                        out.println("<p class='class='cssTitDet'>Debe informar estatus.</p>");
                        out.println("</body>");
                        out.println("</html>");
                        out.close();
                        return;
                    }
                } else {
                    out.println("<p class='class='cssTitDet'>Debe informar estatus.</p>");
                    out.println("</body>");
                    out.println("</html>");
                    out.close();
                    return;
                }

                if (sessionH.getAttribute("clExpediente") != null) {
                    StrclExpediente = sessionH.getAttribute("clExpediente").toString();
                }
                if (request.getParameter("URLBACK1") != null) {
                    StrURLBACK = request.getParameter("URLBACK1").toString();
                } else {
                    out.println("<p class='class='cssTitDet'>Error en la carga de información. Consulte a su Administrador.</p>");
                    out.println("</body>");
                    out.println("</html>");
                    out.close();
                    return;
                }

                if (request.getParameter("clProveedor1") != null) {
                    StrclProveedor = request.getParameter("clProveedor1").toString();
                } else {
                    if (request.getParameter("clProveedor1").toString().compareToIgnoreCase("") != 0) {
                        StrclProveedor = request.getParameter("clProveedor1").toString();
                    } else {
                        out.println("<p class='class='cssTitDet'>Debe informar proveedor.</p>");
                        out.println("</body>");
                        out.println("</html>");
                        return;
                    }
                }
                if (request.getParameter("Observaciones1") != null) {
                    StrObservaciones = request.getParameter("Observaciones1").toString();
                }

                break;
            default:
                break;
        }

        try {
            //rsEx = UtileriasBDF.rsSQLNP("sp_GuardaSeguimiento " + strTipoSeguimiento + "," + StrclExpediente + "," + StrclEstatus + ",'" + StrObservaciones + "'," + StrclUsrApp + "," + StrclProveedor + ",'" + StrNoSiniestro + "'");
            rsEx = UtileriasBDF.rsSQLNP("sp_GuardaSeguimiento '" + StrclExpediente + "','" + StrclEstatus + "','" + StrclMotivo + "','" + StrObservaciones + "','" + StrclUsrApp + "','" + StrclProveedor + "'");
            System.out.println("sp_GuardaSeguimiento '" + StrclExpediente + "','" + StrclEstatus + "','" + StrclMotivo + "','" + StrObservaciones + "','" + StrclUsrApp + "','" + StrclProveedor + "'");
            if (rsEx.next()) {
                String strclExpedienteRt = rsEx.getString("clExpediente");
                if (strclExpedienteRt != null) {
                    StrclExpedienteBK = strclExpedienteRt.toString();
                    if (StrclExpedienteBK.compareToIgnoreCase("0") == 0) {
                        out.println("<p class='class='cssTitDet'>" + rsEx.getString("Mensaje").toString() + "</p>");
                        out.println("</body>");
                        out.println("</html>");
                        out.close();
                        return;
                    }
                    out.println("<script>location.href=\"" + StrURLBACK + "\"</script>");
                } else {
                    out.println("<p class='class='cssTitDet'>Error en la transacción. Consulte a su Administrador.</p>");
                    out.println("</body>");
                    out.println("</html>");
                    out.close();
                    return;
                }
                rsEx.close();
            }
        } catch (Exception e) {
            out.close();
            e.printStackTrace();
//            this.destroy();
        } finally {
            try {
                if (rsEx != null) {
                    rsEx.close();
                    rsEx = null;
                }
            } catch (Exception ee) {
                ee.printStackTrace();
            }
        }

        out.println("</body>");
        out.println("</html>");
        out.close();
//        this.destroy();
    }

    protected void doGet(HttpServletRequest request, HttpServletResponse response)
            throws ServletException, IOException {
        processRequest(request, response);
    }

    protected void doPost(HttpServletRequest request, HttpServletResponse response)
            throws ServletException, IOException {
        processRequest(request, response);
    }

    public String getServletInfo() {
        return "Short description";
    }
}
