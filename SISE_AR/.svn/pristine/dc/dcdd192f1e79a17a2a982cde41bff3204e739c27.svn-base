<%@ page contentType="text/html; charset=iso-8859-1" language="java" %>
<%@ page import="com.ike.asistencias.DAOAsistenciaHogar,com.ike.asistencias.to.DetalleAsistenciaHogar,Seguridad.SeguridadC,Combos.cbPais,Combos.cbEntidad,Combos.cbAMIS,java.sql.ResultSet,Utilerias.UtileriasBDF"%>

<html>
    <head>
        <title>Detalle Asistencia Hogar</title>
        <link href="../../StyleClasses/Global.css" rel="stylesheet" type="text/css">
    </head>
    <body class="cssBody" onload="fnHabilitaSolucion();">
        <jsp:useBean id="MyUtil" scope="session" class="Utilerias.UtileriasObj"/>
        <script type="text/javascript" src='../../Utilerias/Util.js'></script>
        <script type="text/javascript" src='../../Utilerias/UtilMask.js'></script>
        <script type="text/javascript" src='../../Utilerias/UtilDireccion.js'></script>
        <script type="text/javascript" src='../../Utilerias/UtilAjax.js'></script>

        <%
            String StrclUsrApp = "";
            String StrclExpediente = "";
            String StrclPaginaWeb = "162";

            //  DATOS DE LA UBICACION ORIGEN, VIENEN DEL EXPEDIENTE EN SESION
            String StrclPais = "10";
            String StrdsPais = "";
            String StrdsEntFed = "";
            String StrCodEnt = "";
            String StrdsMunDel = "";
            String StrCodMD = "";
            String StrCalleNum = "";
            String StrclCuenta = "0";
            String StrClave = "";
            String StrdsSubServicio = "";

            if (session.getAttribute("clUsrApp") != null) {
                StrclUsrApp = session.getAttribute("clUsrApp").toString();
            }
            
            if (session.getAttribute("clExpediente") != null) {
                StrclExpediente = session.getAttribute("clExpediente").toString();
            }
            
            if (session.getAttribute("clPais") != null) {
                StrclPais = session.getAttribute("clPais").toString();
            }
            
            if (session.getAttribute("dsPais") != null) {
                StrdsPais = session.getAttribute("dsPais").toString();
            }
            
            if (session.getAttribute("CodEnt") != null) {
                StrCodEnt = session.getAttribute("CodEnt").toString();
            }
            
            if (session.getAttribute("dsEntFed") != null) {
                StrdsEntFed = session.getAttribute("dsEntFed").toString();
            }
            
            if (session.getAttribute("CodMD") != null) {
                StrCodMD = session.getAttribute("CodMD").toString();
            }
            
            if (session.getAttribute("dsMunDel") != null) {
                StrdsMunDel = session.getAttribute("dsMunDel").toString();
            }
            
            if (session.getAttribute("clCuenta") != null) {
                StrclCuenta = session.getAttribute("clCuenta").toString();
            }
            
            if (session.getAttribute("Clave") != null) {
                StrClave = session.getAttribute("Clave").toString();
            }
            
            if (session.getAttribute("dsSubServicio") != null) {
                StrdsSubServicio = session.getAttribute("dsSubServicio").toString();
            }

            if (SeguridadC.verificaHorarioC(Integer.parseInt(StrclUsrApp)) != true) {
        %>Fuera de Horario<%
                        StrclUsrApp = null;
                        StrclExpediente = null;
                        StrclPaginaWeb = null;
                        StrclPais = null;
                        StrdsPais = null;
                        StrdsEntFed = null;
                        StrCodEnt = null;
                        StrdsMunDel = null;
                        StrCodMD = null;
                        StrclCuenta = null;
                        StrClave = null;
                        StrCalleNum = null;
                        StrdsSubServicio = null;
                        return;
                    }

                    StringBuffer StrSql = new StringBuffer();

                    DAOAsistenciaHogar daoAH = null;
                    DetalleAsistenciaHogar AH = null;

                    StrSql.append(" st_TieneAsistenciaExp ").append(StrclExpediente);
                    ResultSet rs = UtileriasBDF.rsSQLNP(StrSql.toString());
                    StrSql.delete(0, StrSql.length());

                    if (rs.next()) {
                        daoAH = new DAOAsistenciaHogar();
                        AH = daoAH.getDetalleAsistenciaHogar(StrclExpediente);

                        //  DATOS DE LA UBICACION DESTINO
                    } else {
        %> El expediente no existe <%
                rs.close();
                rs = null;

                StrclUsrApp = null;
                StrclExpediente = null;
                StrclPaginaWeb = null;
                StrclPais = null;
                StrdsPais = null;
                StrdsEntFed = null;
                StrCodEnt = null;
                StrdsMunDel = null;
                StrCodMD = null;
                StrclCuenta = null;
                StrClave = null;
                StrCalleNum = null;
                StrdsSubServicio = null;
                return;
            }

            StrSql.append(" st_getDatosAfiliado '").append(StrClave).append("','").append(StrclCuenta).append("'");
            ResultSet rsDatosAfil = UtileriasBDF.rsSQLNP(StrSql.toString());

            StrSql.delete(0, StrSql.length());

            if (rsDatosAfil.next()) {
                StrCalleNum = rsDatosAfil.getString("callenum");
            }

            session.setAttribute("clPaginaWebP", StrclPaginaWeb);
        %>

        <script type="text/javascript">fnOpenLinks()</script>
        <%MyUtil.InicializaParametrosC(162, Integer.parseInt(StrclUsrApp));%>
        <!--%=MyUtil.doMenuAct("../../servlet/Utilerias.EjecutaAccionAsist", "", "fnAntesGuardar();")%-->
        <%=MyUtil.doMenuAct("../../servlet/Utilerias.EjecutaAccionAsist", "", "")%>
        <INPUT id='URLBACK' name='URLBACK' type='hidden' value='<%=request.getRequestURL().substring(0, request.getRequestURL().lastIndexOf("/") + 1)%><%="DetalleAHogar.jsp?"%>'>
        <INPUT id='clExpediente' name='clExpediente' type='hidden' value='<%=StrclExpediente%>'>

        <%=MyUtil.ObjTextArea("Ubicación de la Falla", "UbicacionFalla", AH != null ? AH.getUbicacionFalla() : "", "50", "5", true, true, 30, 80, "", true, true)%>
        <%=MyUtil.ObjTextArea("Descripción de la Falla", "DescripcionFalla", AH != null ? AH.getDescripcionFalla() : "", "50", "5", true, true, 420, 80, "", true, true)%>
        <%=MyUtil.ObjComboC("Tipo solucion", "clTipoSolucion", AH != null ? AH.getDsTipoSolucion() : "", true, true, 30, 170, "", "select 0 'clConcepto', 'OTRO' 'dsConcepto' union select clConcepto,dsConcepto from cConceptoCosto where clAreaOperativa = 4 order by dsConcepto", "", "fnHabilitaSolucion()", 50, true, true)%>
        <%=MyUtil.ObjTextArea("Descripcion Solución", "Solucion", AH != null ? AH.getSolucion() : "", "50", "6", true, true, 30, 210, "", false, false)%>
        <!--%=MyUtil.ObjInput("Verificador", "Verificador", AH != null ? AH.getVerificador() : "", false, false, 270, 266, "", false, false, 20, "")%-->
        <%=MyUtil.ObjTextArea("Observaciones", "Observaciones", AH != null ? AH.getObservaciones() : "", "50", "5", true, true, 420, 170, "", true, true)%>
        <%=MyUtil.ObjChkBox("Cita Programada", "EsProgramado", AH != null ? AH.getEsProgramado() : "", false, false, 420, 280, "0", "fnFechaProg()")%>
        <%=MyUtil.ObjInput("Fecha Programada<br>(aaaa/mm/dd hh:mm)", "FechaProgMom", AH != null ? AH.getFechaProgMom() : "", false, false, 570, 255, "", false, false, 20, "if(this.readOnly==false){fnValMask(this,document.all.FechaProgMomMsk.value,this.name)};")%>
        <%=MyUtil.DoBlock("Detalle de " + StrdsSubServicio, -45, -20)%>

        <%=MyUtil.ObjComboMem("Pais", "clPais", StrdsPais, StrclPais, cbPais.GeneraHTML(20, StrdsPais), false, false, 30, 350, StrclPais, "fnLlenaEntidadAjaxFn(this.value,2);", "", 20, false, false)%>
        <%=MyUtil.ObjComboMemDiv("Provincia", "CodEnt", StrdsEntFed, StrCodEnt, cbEntidad.GeneraHTML(40, StrdsEntFed, Integer.parseInt(StrclPais)), false, false, 30, 390, StrCodEnt, "fnLLenaComboMDAjax(this.value,2);", "", 20, false, false, "CodEntDiv")%>
        <%=MyUtil.ObjComboMemDiv("Localidad", "CodMD", StrdsMunDel, StrCodMD, cbEntidad.GeneraHTMLMD(40, StrCodEnt, StrdsMunDel), false, false, 30, 430, StrCodMD, "", "", 20, false, false, "LocalidadDiv")%>
        <%=MyUtil.ObjInput("Calle y Número", "Calle", AH != null ? AH.getCalle() : "", true, true, 30, 470, StrCalleNum, false, false, 76)%>
        <%=MyUtil.ObjTextArea("Referencias Visuales", "Referencias", AH != null ? AH.getReferencias() : "", "75", "5", true, true, 30, 510, "", false, false)%>
        <%=MyUtil.DoBlock("Domicilio", 220, 40)%>
        <%=MyUtil.GeneraScripts()%>

        <%
            rs.close();
            rs = null;

            daoAH = null;
            AH = null;

            StrclUsrApp = null;
            StrclExpediente = null;
            StrclPaginaWeb = null;
            StrclPais = null;
            StrdsPais = null;
            StrdsEntFed = null;
            StrCodEnt = null;
            StrdsMunDel = null;
            StrCodMD = null;
            StrclCuenta = null;
            StrClave = null;
            StrCalleNum = null;
            StrdsSubServicio = null;

        %>
        <input name='FechaProgMomMsk' id='FechaProgMomMsk' type='hidden' value='VN09VN09VN09VN09F-/-VN09VN09F-/-VN09VN09F 00VN09VN09F:00VN00VN00'>

        <script type="text/javascript" >
            //document.all.FechaProgMom.disabled=true;
            document.all.Solucion.disabled = true;

            function fnHabilitaSolucion() {
                if (document.all.clTipoSolucion.value != '') {
                    if (document.all.clTipoSolucion.value == 0) {
                        document.all.Solucion.disabled = false;
                    } else {
                        document.all.Solucion.value = '';
                        document.all.Solucion.disabled = true;
                    }
                }
            }

            function fnFechaProg() {
                if (document.all.EsProgramado.value == 1) {
                    document.all.FechaProgMom.disabled = false;
                    document.all.FechaProgMom.focus();
                }

                if (document.all.EsProgramado.value == 0) {
                    document.all.FechaProgMom.value = '';
                    document.all.Solucion.disabled = true;
                }
            }

            /* function fnAntesGuardar() {
             if (document.all.EsProgramado.value == 1) {
             if (document.all.FechaProgMom.value == '') {
             msgVal = msgVal + " Fecha Programada ";
             document.all.btnGuarda.disabled = false;
             document.all.btnCancela.disabled = false;
             }
             }
             
             if (document.all.clTipoSolucion.value == 0 && document.all.Solucion.value == '') {
             msgVal = msgVal + " Falta informar la descripción solución ";
             document.all.btnGuarda.disabled = false;
             document.all.btnCancela.disabled = false;
             }
             }*/
        </script>
    </body>
</html>

